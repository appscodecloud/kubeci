apiVersion: kubeci.kube.ci/v1alpha1
kind: Workflow
metadata:
  name: watch-git-branch
  namespace: default
spec:
  triggers:
  - apiVersion: git.kube.ci/v1alpha1
    kind: Branch
    resource: branches
    name: kubeci-gpig-master
    namespace: default
    selector:
      matchLabels:
        repository: kubeci-gpig
    onCreateOrUpdate: true
    onDelete: false
  executionOrder: DAG
  steps:
  - name: step-clone
    image: alpine/git
    commands:
    - git
    args:
    - clone
    - https://github.com/diptadas/kubeci-gpig.git
    - /kubeci/kubeci-gpig
  - name: step-list
    image: alpine
    commands:
    - sh
    args:
    - -c
    - echo listing files...; ls /kubeci/kubeci-gpig
    dependency:
    - step-clone
  - name: step-test
    image: golang:alpine
    commands:
    - sh
    args:
    - -c
    - echo running test...; cd /kubeci/kubeci-gpig; go test -v || true
    dependency:
    - step-clone
